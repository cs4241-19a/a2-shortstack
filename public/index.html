<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="title">
      Daily Schedule
    </div>
    <div class="board" data-board="fullboard"> 
      <div class="boardsection" data-board="day_1">
        <div class="header" day="1">
          Sunday
        </div>
        <div class="tasklist" day="1">
          
        </div>
      </div>
      <div class="boardsection" data-board="day_2">
      <div class="header" day="2">
          Monday
        </div>
        <div class="tasklist" day="2">
          
        </div>
      </div>
      <div class="boardsection" data-board="day_3">
      <div class="header" day="3">
          Tuesday
        </div>
        <div class="tasklist" day="3">
          
        </div>
      </div>      
      <div class="boardsection" data-board="day_4">
        <div class="header" day="4">
          Wednesday
        </div>
        <div class="tasklist" day="4">
          
        </div>
      </div>
      <div class="boardsection" data-board="day_5">
        <div class="header" day="5">
          Thursday
        </div>
        <div class="tasklist" day="5">
          
        </div>
      </div>
      <div class="boardsection" data-board="day_6">
        <div class="header" day="6">
          Friday
        </div>
        <div class="tasklist" day="6">
          
        </div>
      </div>
      <div class="boardsection" data-board="day_7">
        <div class="header" day="7">
          Saturday
        </div>
        <div class="tasklist" day="7">
          
        </div>
      </div>    
    </div>
    <div class="menu">
      <button id="next">
        Next Day
      </button>
      <form>
        <div class="menu-data">
          <span> Day: </span>
          <input type="text" id="day" value="Monday">
          <span> Task: </span>
          <input type="text" id="task" value="HW">
          <span> Time: </span>
          <input type="time" id="time" value="02:00">
        </div>

        <button id="submit">Add to Schedule</button>
      </form>
    </div>
    
  </body>
  <script type="text/javascript" src="js/scripts.js"></script>
  <script>
  const submit = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault()

    const url = '/information',
          input = document.querySelector( '#response' ),
          json = { yourresponse: input.value },
          body = JSON.stringify( json ),
          answer = document.querySelector( '#answer')
    
    fetch( '/submit', {
      method:'POST',
      body
    })
    .then( function( response ) {
      // do something with the reponse 
      //text.textContent = response;
      console.log( response )
      //occupyText()
      
    
      fetch(url)
        .then(function( response ) {
          //response.json();

          console.log(response)
      }).then(function(data) {
        //answer.innerHTML = data
        //console.log(info)
      });
      

      
    })

    return false
  }
  
  const occupySchedule = function() {
    alert("Running");
    fetch( '/info' )
      .then( function( response ) {
        console.log( response )
        return response.json()
    })
      .then( function( myJSON ) {
        var info = myJSON.data
        
        var i;
        for(i = 0; i < info.length; i++){
          createEvent(info[i].index, info[i].day, info[i].task, info[i].time);
        }

        console.log( JSON.stringify( myJSON ) )
    })
  }
  
  const addEvent = function(e) {
    e.preventDefault();
    var day = document.querySelector("#day").value
    var task = document.querySelector("#task").value
    var time = document.querySelector("#time").value
    var index = day + task + time
    console.log("Index"+ index +"Day: " + day + " Time: " + time + " Task: "+ task);

    var newEvent = {
      index : index,
      day : document.querySelector("#day").value,
      task : document.querySelector("#task").value,
      time : document.querySelector("#time").value,
    };
    
    var body = JSON.stringify( newEvent );
    fetch('/submit',{
      method: 'POST',
      body
    }).then( function( response ) {
      createEvent(index, day, task, time);

      document.querySelector("#day").value = '';
      document.querySelector("#task").value = '';
      document.querySelector("#time").value = '';
    })
    
    return false
  }
  
  const deleteEvent = function(e) {
    e.preventDefault();
    var eventInd;
    var pointer = document.querySelector('.boardsection[data-board]:first-child .tasklist')
    var pointerChild = document.querySelector('.boardsection[data-board]:first-child .tasklist:first-child[index]')

    while(pointer.hasChildNodes()){
      //pointer.removeChild(pointer.firstChild)
      if(pointerChild !== null) {
        //eventInd = pointer.firstChild.getAttribute('index');
        
        removeEvent(eventInd)
      }
    }
    
    
  }
  
  
  const removeEvent = function(index) {
    var body = JSON.stringify( index )
    
    fetch('/delete',{
      method: 'POST',
      body
    }).then(function(response) {
      //occupySchedule()
    })
  }
  
  
  const createEvent = function(index, day, task, time){
      var dayNum = dayFinder(day)
      var dayCol = document.querySelector(".boardsection[data-board='"+ dayNum +"'] .tasklist")
      var timeNode = document.createTextNode(time)
      var textNode = document.createTextNode(task)
      var divNode = document.createElement("div")
      var breakNode = document.createElement("br")
      var breakNode1 = document.createElement("br")
      divNode.setAttribute('index', index)
      divNode.appendChild(timeNode)
      divNode.appendChild(breakNode1)
      divNode.appendChild(textNode)
      console.log(dayCol)

      dayCol.appendChild(divNode)
      dayCol.appendChild(breakNode)
  }
  
  const dayFinder = function(str) {
    switch(str.trim().toLowerCase()) {
      case 'sunday':
        return 'day_1'
      case 'monday':
        return 'day_2'
      case 'tuesday':
        return 'day_3'
      case 'wednesday':
        return 'day_4'
      case 'thursday':
        return 'day_5'
      case 'friday':
        return 'day_6'
      case 'saturday':
        return 'day_7'
      default: 
        return 'error'
    }
  }

  
  window.onload = function() {
    occupySchedule();
    
    const button = document.querySelector( '#submit' )
    button.onclick = addEvent
    
    const nextButton = document.querySelector( '#next' )
    nextButton.onclick = deleteEvent
  }
    

  </script>
</html>
